import{r as t}from"./react-De0_xqVL.js";function a(a,e,i){let[n,r]=t.useState(a||e),o=t.useRef(void 0!==a),l=void 0!==a;t.useEffect((()=>{let t=o.current;t!==l&&console.warn(`WARN: A component changed from ${t?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}.`),o.current=l}),[l]);let s=l?a:n,u=t.useCallback(((t,...a)=>{let e=(t,...a)=>{i&&(Object.is(s,t)||i(t,...a)),l||(s=t)};if("function"==typeof t){console.warn("We can not support a function callback. See Github Issues for details https://github.com/adobe/react-spectrum/issues/2320"),r(((i,...n)=>{let r=t(l?s:i,...n);return e(r,...a),l?i:r}))}else l||r(t),e(t,...a)}),[l,s,i]);return[s,u]}const e={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},i={...e,customError:!0,valid:!1},n={isInvalid:!1,validationDetails:e,validationErrors:[]},r=t.createContext({}),o="__formValidationState"+Date.now();function l(a){if(a[o]){let{realtimeValidation:t,displayValidation:e,updateValidation:i,resetValidation:n,commitValidation:r}=a[o];return{realtimeValidation:t,displayValidation:e,updateValidation:i,resetValidation:n,commitValidation:r}}return function(a){let{isInvalid:e,validationState:o,name:l,value:c,builtinValidation:v,validate:f,validationBehavior:m="aria"}=a;o&&(e||(e="invalid"===o));let p=void 0!==e?{isInvalid:e,validationErrors:[],validationDetails:i}:null,V=t.useMemo((()=>u(function(t,a){if("function"==typeof t){let e=t(a);if(e&&"boolean"!=typeof e)return s(e)}return[]}(f,c))),[f,c]);(null==v?void 0:v.validationDetails.valid)&&(v=null);let y=t.useContext(r),h=t.useMemo((()=>l?Array.isArray(l)?l.flatMap((t=>s(y[t]))):s(y[l]):[]),[y,l]),[E,b]=t.useState(y),[g,S]=t.useState(!1);y!==E&&(b(y),S(!1));let I=t.useMemo((()=>u(g?[]:h)),[g,h]),M=t.useRef(n),[D,A]=t.useState(n),w=t.useRef(n),R=()=>{if(!j)return;x(!1);let t=V||v||M.current;d(t,w.current)||(w.current=t,A(t))},[j,x]=t.useState(!1);return t.useEffect(R),{realtimeValidation:p||I||V||v||n,displayValidation:"native"===m?p||I||D:p||I||V||v||D,updateValidation(t){"aria"!==m||d(D,t)?M.current=t:A(t)},resetValidation(){let t=n;d(t,w.current)||(w.current=t,A(t)),"native"===m&&x(!1),S(!0)},commitValidation(){"native"===m&&x(!0),S(!0)}}}(a)}function s(t){return t?Array.isArray(t)?t:[t]:[]}function u(t){return t.length?{isInvalid:!0,validationErrors:t,validationDetails:i}:null}function d(t,a){return t===a||t&&a&&t.isInvalid===a.isInvalid&&t.validationErrors.length===a.validationErrors.length&&t.validationErrors.every(((t,e)=>t===a.validationErrors[e]))&&Object.entries(t.validationDetails).every((([t,e])=>a.validationDetails[t]===e))}export{a as $,l as a};
